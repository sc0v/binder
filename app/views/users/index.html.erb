<% if can?(:read, User) %>
  <h3>Users</h3>
  <div class="span12">

  <% if can?(:create, :user) %>
    <%= link_to raw("Add a New User"), new_user_path, :class => 'btn btn-primary' %>
  <% end %>

    <table class="table table-condensed">
      <thead>
        <tr>
          <th>Username</th>
          <th>Email</th>
          <th>Registered</th>
          <th>Role</th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      <% @users.each do |user| %>
        <tr>
          <td><%= link_to user.name, user %></td>
          <td><%= user.email %></td>
          <td><%= user.created_at.to_date %></td>
          <td>
            <% if can?(:read, user.roles) %>
              <%= user.roles.first.name.titleize unless user.roles.first.nil? %>
            <% end %>
          </td>
          <td>
            <% if can?(:update, user.roles) %>
              <a data-toggle="modal" href="#role-options-<%= user.id %>" class="btn btn-xs" type="button">Change role</a>
              <%= render user, :redirect => users_path %>
            <% end %>
          </td>
          <td>
            <% if can?(:delete, user) %>
              <%= link_to("Delete user", user_path(user), :data => { :confirm => "Are you sure?" }, :method => :delete, :class => 'btn btn-xs') unless user == current_user %>
            <% end %>
          </td>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>


  
  <% else %>
    <h3>Not Authorized!</h3>
<% end %>
